{"version":3,"file":"commonHelpers3.js","sources":["../src/js/loadmore.js"],"sourcesContent":["import apiService from './api';\r\nimport { lightbox } from './lightbox';\r\nimport iziToast from 'izitoast';\r\nimport 'izitoast/dist/css/iziToast.min.css';\r\n\r\nconst searchButton = document.getElementById('search-button');\r\nconst galleryContainer = document.querySelector('.gallery');\r\nconst searchQueryInput = document.querySelector('#search-bar');\r\nconst loadMoreButton = document.querySelector('.btn__load-more');\r\n\r\nlet isShown = 0;\r\nlet isFirstSearch = true;\r\nlet query = '';\r\n\r\nsearchButton.addEventListener('click', function (event) {\r\n  event.preventDefault();\r\n  onSearch();\r\n  isFirstSearch = true;\r\n});\r\n\r\nsearchQueryInput.addEventListener('keydown', function (event) {\r\n  if (event.key === 'Enter') {\r\n    event.preventDefault();\r\n    onSearch();\r\n  }\r\n  isFirstSearch = true;\r\n});\r\n\r\nasync function onSearch() {\r\n  const searchQuery = searchQueryInput.value.trim();\r\n\r\n  apiService.setQuery(searchQuery);\r\n\r\n  if (searchQuery === '') {\r\n    loadMoreButton.classList.add('is-hidden');\r\n    showWarningToast('Будь ласка, заповніть поле пошуку');\r\n    return;\r\n  }\r\n\r\n  if (searchQuery === query) {\r\n    loadMoreButton.classList.add('is-hidden');\r\n    showWarningToast(\r\n      'Будь ласка, змініть або введіть новий запит до поля пошуку.'\r\n    );\r\n    return;\r\n  }\r\n\r\n  galleryContainer.innerHTML = '';\r\n  apiService.resetPage();\r\n  query = searchQuery;\r\n  isShown = 0;\r\n  await fetchGallery();\r\n}\r\n\r\nasync function fetchGallery() {\r\n  try {\r\n    const result = await apiService.fetchGallery();\r\n    const { hits, totalHits } = result;\r\n\r\n    if (!hits.length) {\r\n      loadMoreButton.classList.add('is-hidden');\r\n      showErrorToast(\r\n        'Вибачте, немає зображень, які відповідають вашому запиту. Будь ласка, спробуйте ще раз.'\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (isFirstSearch && isShown < totalHits) {\r\n      showSuccessToast(`Ура! Ми знайшли ${totalHits} зображень !!!`);\r\n      isFirstSearch = false;\r\n      loadMoreButton.classList.remove('is-hidden');\r\n    }\r\n\r\n    onRenderGallery(hits);\r\n    isShown += hits.length;\r\n\r\n    if (isShown >= totalHits) {\r\n      loadMoreButton.classList.add('is-hidden');\r\n      showInfoToast('Ви досягли кінця результатів пошуку.');\r\n    }\r\n  } catch (error) {\r\n    console.error('Помилка отримання галереї:', error);\r\n    showErrorToast('Під час отримання галереї сталася помилка.');\r\n  }\r\n}\r\n\r\nfunction onRenderGallery(elements) {\r\n  const markup = elements\r\n    .map(({ webformatURL, largeImageURL, tags, likes, views, downloads }) => {\r\n      return `\r\n      <div class=\"photo-card\">\r\n        <a href=\"${largeImageURL}\">\r\n          <img class=\"photo-img\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\r\n        </a>\r\n        <div class=\"info\">\r\n          <p class=\"info-item\"><b>Likes</b><span class=\"info__span\">${likes}</span></p>\r\n          <p class=\"info-item\"><b>Views</b><span class=\"info__span\">${views}</span></p>\r\n          <p class=\"info-item\"><b>Downloads</b><span class=\"info__span\">${downloads}</span></p>\r\n        </div>\r\n      </div>`;\r\n    })\r\n    .join('');\r\n\r\n  galleryContainer.insertAdjacentHTML('beforeend', markup);\r\n  lightbox.refresh();\r\n}\r\n\r\nloadMoreButton.addEventListener('click', async () => {\r\n  apiService.incrementPage();\r\n  await fetchGallery();\r\n});\r\n\r\nfunction showWarningToast(message) {\r\n  iziToast.warning({\r\n    title: 'Warning',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'yellow',\r\n    timeout: 4000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showErrorToast(message) {\r\n  iziToast.error({\r\n    title: 'Error',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'red',\r\n    timeout: 3000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showSuccessToast(message) {\r\n  iziToast.success({\r\n    title: 'Success',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'green',\r\n    timeout: 2000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showInfoToast(message) {\r\n  iziToast.info({\r\n    title: 'Info',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'blue',\r\n    timeout: 3000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n"],"names":["searchButton","galleryContainer","searchQueryInput","loadMoreButton","isShown","isFirstSearch","query","event","onSearch","searchQuery","apiService","showWarningToast","fetchGallery","result","hits","totalHits","showErrorToast","showSuccessToast","onRenderGallery","showInfoToast","error","elements","markup","webformatURL","largeImageURL","tags","likes","views","downloads","lightbox","message","iziToast"],"mappings":"6IAKA,MAAMA,EAAe,SAAS,eAAe,eAAe,EACtDC,EAAmB,SAAS,cAAc,UAAU,EACpDC,EAAmB,SAAS,cAAc,aAAa,EACvDC,EAAiB,SAAS,cAAc,iBAAiB,EAE/D,IAAIC,EAAU,EACVC,EAAgB,GAChBC,EAAQ,GAEZN,EAAa,iBAAiB,QAAS,SAAUO,EAAO,CACtDA,EAAM,eAAc,EACpBC,IACAH,EAAgB,EAClB,CAAC,EAEDH,EAAiB,iBAAiB,UAAW,SAAUK,EAAO,CACxDA,EAAM,MAAQ,UAChBA,EAAM,eAAc,EACpBC,KAEFH,EAAgB,EAClB,CAAC,EAED,eAAeG,GAAW,CACxB,MAAMC,EAAcP,EAAiB,MAAM,KAAI,EAI/C,GAFAQ,EAAW,SAASD,CAAW,EAE3BA,IAAgB,GAAI,CACtBN,EAAe,UAAU,IAAI,WAAW,EACxCQ,EAAiB,mCAAmC,EACpD,MACD,CAED,GAAIF,IAAgBH,EAAO,CACzBH,EAAe,UAAU,IAAI,WAAW,EACxCQ,EACE,6DACN,EACI,MACD,CAEDV,EAAiB,UAAY,GAC7BS,EAAW,UAAS,EACpBJ,EAAQG,EACRL,EAAU,EACV,MAAMQ,EAAY,CACpB,CAEA,eAAeA,GAAe,CAC5B,GAAI,CACF,MAAMC,EAAS,MAAMH,EAAW,eAC1B,CAAE,KAAAI,EAAM,UAAAC,CAAW,EAAGF,EAE5B,GAAI,CAACC,EAAK,OAAQ,CAChBX,EAAe,UAAU,IAAI,WAAW,EACxCa,EACE,yFACR,EACM,MACD,CAEGX,GAAiBD,EAAUW,IAC7BE,EAAiB,mBAAmBF,CAAS,gBAAgB,EAC7DV,EAAgB,GAChBF,EAAe,UAAU,OAAO,WAAW,GAG7Ce,EAAgBJ,CAAI,EACpBV,GAAWU,EAAK,OAEZV,GAAWW,IACbZ,EAAe,UAAU,IAAI,WAAW,EACxCgB,EAAc,sCAAsC,EAEvD,OAAQC,EAAO,CACd,QAAQ,MAAM,6BAA8BA,CAAK,EACjDJ,EAAe,4CAA4C,CAC5D,CACH,CAEA,SAASE,EAAgBG,EAAU,CACjC,MAAMC,EAASD,EACZ,IAAI,CAAC,CAAE,aAAAE,EAAc,cAAAC,EAAe,KAAAC,EAAM,MAAAC,EAAO,MAAAC,EAAO,UAAAC,KAChD;AAAA;AAAA,mBAEMJ,CAAa;AAAA,wCACQD,CAAY,UAAUE,CAAI;AAAA;AAAA;AAAA,sEAGIC,CAAK;AAAA,sEACLC,CAAK;AAAA,0EACDC,CAAS;AAAA;AAAA,aAG9E,EACA,KAAK,EAAE,EAEV3B,EAAiB,mBAAmB,YAAaqB,CAAM,EACvDO,EAAS,QAAO,CAClB,CAEA1B,EAAe,iBAAiB,QAAS,SAAY,CACnDO,EAAW,cAAa,EACxB,MAAME,EAAY,CACpB,CAAC,EAED,SAASD,EAAiBmB,EAAS,CACjCC,EAAS,QAAQ,CACf,MAAO,UACP,QAASD,EACT,SAAU,WACV,MAAO,SACP,QAAS,IACT,cAAe,GACf,aAAc,EAClB,CAAG,CACH,CAEA,SAASd,EAAec,EAAS,CAC/BC,EAAS,MAAM,CACb,MAAO,QACP,QAASD,EACT,SAAU,WACV,MAAO,MACP,QAAS,IACT,cAAe,GACf,aAAc,EAClB,CAAG,CACH,CAEA,SAASb,EAAiBa,EAAS,CACjCC,EAAS,QAAQ,CACf,MAAO,UACP,QAASD,EACT,SAAU,WACV,MAAO,QACP,QAAS,IACT,cAAe,GACf,aAAc,EAClB,CAAG,CACH,CAEA,SAASX,EAAcW,EAAS,CAC9BC,EAAS,KAAK,CACZ,MAAO,OACP,QAASD,EACT,SAAU,WACV,MAAO,OACP,QAAS,IACT,cAAe,GACf,aAAc,EAClB,CAAG,CACH"}