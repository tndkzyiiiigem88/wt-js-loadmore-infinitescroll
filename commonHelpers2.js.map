{"version":3,"file":"commonHelpers2.js","sources":["../src/js/infinitescroll.js"],"sourcesContent":["import apiService from './api';\r\nimport { lightbox } from './lightbox';\r\nimport iziToast from 'izitoast';\r\nimport 'izitoast/dist/css/iziToast.min.css';\r\n\r\nconst searchButton = document.getElementById('search-button');\r\nconst galleryContainer = document.querySelector('.gallery');\r\nconst searchQueryInput = document.querySelector('#search-bar');\r\n\r\nlet isShown = 0;\r\nlet isFirstSearch = true;\r\nlet query = '';\r\n\r\nconst observerOptions = {\r\n  root: null,\r\n  rootMargin: '0px',\r\n  threshold: 0.5,\r\n};\r\n\r\nconst intersectionObserver = new IntersectionObserver(\r\n  handleIntersection,\r\n  observerOptions\r\n);\r\n\r\nsearchButton.addEventListener('click', function (event) {\r\n  event.preventDefault();\r\n  onSearch();\r\n  isFirstSearch = true;\r\n});\r\n\r\nsearchQueryInput.addEventListener('keydown', function (event) {\r\n  if (event.key === 'Enter') {\r\n    event.preventDefault();\r\n    onSearch();\r\n  }\r\n  isFirstSearch = true;\r\n});\r\n\r\nasync function onSearch() {\r\n  const searchQuery = searchQueryInput.value.trim();\r\n\r\n  apiService.setQuery(searchQuery);\r\n\r\n  if (searchQuery === '') {\r\n    showWarningToast('Будь ласка, заповніть поле пошуку');\r\n    return;\r\n  }\r\n\r\n  if (searchQuery === query) {\r\n    showWarningToast(\r\n      'Будь ласка, змініть або введіть новий запит до поля пошуку.'\r\n    );\r\n    return;\r\n  }\r\n\r\n  galleryContainer.innerHTML = '';\r\n  apiService.resetPage();\r\n  query = searchQuery;\r\n  isShown = 0;\r\n  await fetchGallery();\r\n}\r\n\r\nasync function fetchGallery() {\r\n  try {\r\n    const result = await apiService.fetchGallery();\r\n    const { hits, totalHits } = result;\r\n\r\n    if (!hits.length) {\r\n      showErrorToast(\r\n        'Вибачте, немає зображень, які відповідають вашому запиту. Будь ласка, спробуйте ще раз.'\r\n      );\r\n      return;\r\n    }\r\n\r\n    if (isFirstSearch && isShown < totalHits) {\r\n      showSuccessToast(`Ура! Ми знайшли ${totalHits} зображень !!!`);\r\n      isFirstSearch = false;\r\n    }\r\n\r\n    onRenderGallery(hits);\r\n    isShown += hits.length;\r\n\r\n    const lastElement = galleryContainer.lastElementChild;\r\n    if (lastElement) {\r\n      intersectionObserver.observe(lastElement);\r\n    }\r\n\r\n    if (isShown >= totalHits) {\r\n      intersectionObserver.disconnect();\r\n      showInfoToast('Ви досягли кінця результатів пошуку.');\r\n    }\r\n  } catch (error) {\r\n    console.error('Помилка отримання галереї:', error);\r\n    showErrorToast('Під час отримання галереї сталася помилка.');\r\n  }\r\n}\r\n\r\nfunction onRenderGallery(elements) {\r\n  const markup = elements\r\n    .map(({ webformatURL, largeImageURL, tags, likes, views, downloads }) => {\r\n      return `\r\n      <div class=\"photo-card\">\r\n        <a href=\"${largeImageURL}\">\r\n          <img class=\"photo-img\" src=\"${webformatURL}\" alt=\"${tags}\" loading=\"lazy\" />\r\n        </a>\r\n        <div class=\"info\">\r\n          <p class=\"info-item\"><b>Likes</b><span class=\"info__span\">${likes}</span></p>\r\n          <p class=\"info-item\"><b>Views</b><span class=\"info__span\">${views}</span></p>\r\n          <p class=\"info-item\"><b>Downloads</b><span class=\"info__span\">${downloads}</span></p>\r\n        </div>\r\n      </div>`;\r\n    })\r\n    .join('');\r\n\r\n  galleryContainer.insertAdjacentHTML('beforeend', markup);\r\n  lightbox.refresh();\r\n}\r\n\r\nfunction handleIntersection(entries, _observer) {\r\n  entries.forEach(entry => {\r\n    if (entry.isIntersecting) {\r\n      apiService.incrementPage();\r\n      fetchGallery();\r\n    }\r\n  });\r\n}\r\n\r\nfunction showWarningToast(message) {\r\n  iziToast.warning({\r\n    title: 'Warning',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'yellow',\r\n    timeout: 4000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showErrorToast(message) {\r\n  iziToast.error({\r\n    title: 'Error',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'red',\r\n    timeout: 3000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showSuccessToast(message) {\r\n  iziToast.success({\r\n    title: 'Success',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'green',\r\n    timeout: 2000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n\r\nfunction showInfoToast(message) {\r\n  iziToast.info({\r\n    title: 'Info',\r\n    message: message,\r\n    position: 'topRight',\r\n    color: 'blue',\r\n    timeout: 3000,\r\n    closeOnEscape: true,\r\n    closeOnClick: true,\r\n  });\r\n}\r\n"],"names":["searchButton","galleryContainer","searchQueryInput","isShown","isFirstSearch","query","observerOptions","intersectionObserver","handleIntersection","event","onSearch","searchQuery","apiService","showWarningToast","fetchGallery","result","hits","totalHits","showErrorToast","showSuccessToast","onRenderGallery","lastElement","showInfoToast","error","elements","markup","webformatURL","largeImageURL","tags","likes","views","downloads","lightbox","entries","_observer","entry","message","iziToast"],"mappings":"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"}